{% extends "base.html" %}
{% block title %}Imagens da Moto — {{ moto.modelo }} ({{ moto.placa }}){% endblock %}
{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
  <h2>Imagens da Moto</h2>
  <a class="btn btn-outline-secondary" href="{{ url_for('motos.listar_motos') }}">
    <i class="fa-solid fa-arrow-left me-1"></i> Voltar
  </a>
</div>

<!-- Info da moto -->
<div class="card mb-4 shadow-sm">
  <div class="card-header bg-dark text-white">
    <i class="fa-solid fa-motorcycle me-1"></i> {{ moto.modelo }} — {{ moto.placa }}
  </div>
  <div class="card-body">
    <p class="mb-0">
      <strong>Ano:</strong> {{ moto.ano }}
    </p>
  </div>
</div>

<!-- Formulário de upload -->
<div class="card mb-4 shadow-sm">
  <div class="card-header bg-primary text-white">
    <i class="fa-solid fa-upload me-1"></i> Anexar nova imagem
  </div>
  <div class="card-body">
    <form method="POST" enctype="multipart/form-data">
      <div class="row g-3 align-items-center">
        <div class="col-md-8">
          <input type="file" name="imagem" class="form-control" accept="image/*" required>
          <small class="text-muted">Formatos suportados: JPG, JPEG, PNG. Tamanho razoável recomendado.</small>
        </div>
        <div class="col-md-4">
          <button class="btn btn-success w-100" type="submit">
            <i class="fa-solid fa-cloud-arrow-up me-1"></i> Enviar
          </button>
        </div>
      </div>
    </form>
  </div>
</div>

<!-- Galeria de imagens -->
<div class="row">
  {% if imagens and imagens|length > 0 %}
    {% for img in imagens %}
      <div class="col-md-3 mb-4">
        <div class="card shadow-sm h-100">
          <img src="{{ url_for('motos.uploaded_file', filename=img.arquivo if img.arquivo is defined else img['arquivo']) }}" 
               class="card-img-top" alt="Imagem da moto" style="height: 200px; object-fit: cover;">
          <div class="card-body text-center">
            {% set dt = (img.data_upload if img.data_upload is defined else img['data_upload']) %}
            {% if dt %}
              <small class="text-muted d-block mb-2">Enviado em {{ dt }}</small>
            {% endif %}
            <form method="POST"
                  action="{{ url_for('motos.excluir_imagem_moto', moto_id=moto.id, imagem_id=(img.id if img.id is defined else img['id'])) }}"
                  onsubmit="return confirm('Tem certeza que deseja excluir esta imagem?')">
              <button type="submit" class="btn btn-sm btn-danger">
                <i class="fa-solid fa-trash me-1"></i> Excluir
              </button>
            </form>
          </div>
        </div>
      </div>
    {% endfor %}
  {% else %}
    <div class="col-12">
      <div class="alert alert-info text-center">
        <h5 class="mb-1"><i class="fa-regular fa-images me-1"></i> Nenhuma imagem cadastrada</h5>
        <p class="mb-0">Use o formulário acima para anexar a primeira imagem desta moto.</p>
      </div>
    </div>
  {% endif %}
</div>
{% endblock %}