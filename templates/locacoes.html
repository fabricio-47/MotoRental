{% extends "base.html" %}
{% block content %}
<div class="container mt-4">

  <h2 class="mb-4">Locações Ativas</h2>

  <!-- Formulário nova locação -->
  <form method="POST" enctype="multipart/form-data" class="mb-4 p-3 border rounded bg-light">
    <div class="row">
      <div class="col-md-4">
        <label for="cliente_id" class="form-label">Cliente</label>
        <select name="cliente_id" class="form-control" required>
          <option value="">Selecione</option>
          {% for cliente in clientes %}
          <option value="{{ cliente.id }}">{{ cliente.nome }}</option>
          {% endfor %}
        </select>
      </div>
      <div class="col-md-4">
        <label for="moto_id" class="form-label">Moto (Modelo - Placa)</label>
        <select name="moto_id" class="form-control" required>
          <option value="">Selecione</option>
          {% for moto in motos %}
          <option value="{{ moto.id }}">{{ moto.modelo }} - {{ moto.placa }}</option>
          {% endfor %}
        </select>
      </div>
      <div class="col-md-4">
        <label for="data_inicio" class="form-label">Data Início</label>
        <input type="date" name="data_inicio" class="form-control" required>
      </div>
    </div>
    <div class="row mt-3">
      <div class="col-md-3">
        <label for="valor" class="form-label">Valor (R$)</label>
        <input type="number" name="valor" min="0" step="0.01" class="form-control">
      </div>
      <div class="col-md-9">
        <label for="observacoes" class="form-label">Observações</label>
        <textarea name="observacoes" class="form-control"></textarea>
      </div>
    </div>
    <div class="row mt-3">
      <div class="col-md-12">
        <label for="contrato_pdf" class="form-label">Contrato (PDF)</label>
        <input type="file" name="contrato_pdf" accept="application/pdf" class="form-control">
      </div>
    </div>
    <button type="submit" class="btn btn-primary mt-3">Cadastrar Locação</button>
  </form>

  <!-- Listagem -->
  <table class="table table-striped mt-3">
    <thead>
      <tr>
        <th>ID</th>
        <th>Cliente</th>
        <th>Moto</th>
        <th>Placa</th>
        <th>Data Início</th>
        <th>Data Fim</th>
        <th>Contrato</th>
        <th>Boleto</th>
        <th>Ações</th>
      </tr>
    </thead>
    <tbody>
      {% for locacao in locacoes %}
      <tr>
        <td>{{ locacao.id }}</td>
        <td>{{ locacao.nome }}</td>
        <td>{{ locacao.modelo }}</td>
        <td>{{ locacao.placa }}</td>
        <td>{{ locacao.data_inicio }}</td>
        <td>
          {% if locacao.data_fim %}
            {{ locacao.data_fim }}
          {% else %}
            -
          {% endif %}
        </td>
        <td>
          {% if locacao.contrato_pdf %}
            <a class="btn btn-sm btn-outline-dark"
               href="{{ url_for('uploaded_contract', filename=locacao.contrato_pdf) }}"
               target="_blank">Ver Contrato</a>
          {% else %}
            -
          {% endif %}
        </td>
        <td>
          {% if locacao.boleto_url %}
            <a class="btn btn-sm btn-success" href="{{ locacao.boleto_url }}" target="_blank">Ver Boleto</a>
          {% else %}
            -
          {% endif %}
        </td>
        <td>
          <a href="{{ url_for('editar_locacao', id=locacao.id) }}" class="btn btn-warning btn-sm">Editar</a>
          <form action="{{ url_for('cancelar_locacao', id=locacao.id) }}" method="POST" style="display:inline;">
            <button type="submit" class="btn btn-danger btn-sm"
                    onclick="return confirm('Tem certeza que deseja cancelar esta locação?')">Cancelar</button>
          </form>
          <a href="{{ url_for('servicos_locacao', locacao_id=locacao.id) }}"
             class="btn btn-info btn-sm">Serviços</a>
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>

</div>
{% endblock %}