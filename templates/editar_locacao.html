{% extends "base.html" %}

{% block content %}
<div class="container mt-4">
    <h2>Editar Loca√ß√£o</h2>

    <!-- Bot√£o de sincronizar boletos -->
    <a href="{{ url_for('sincronizar_boletos_manual', id=locacao.id) }}" 
       class="btn btn-outline-info btn-sm me-2">
        üîÑ Sincronizar Boletos
    </a>

    <form method="POST" enctype="multipart/form-data">
        <div class="mb-3">
            <label for="data_inicio" class="form-label">Data In√≠cio</label>
            <input type="date" class="form-control" id="data_inicio" name="data_inicio"
                   value="{{ locacao.data_inicio }}">
        </div>

        <div class="mb-3">
            <label for="data_fim" class="form-label">Data Fim</label>
            <input type="date" class="form-control" id="data_fim" name="data_fim"
                   value="{{ locacao.data_fim if locacao.data_fim }}">
        </div>

        <div class="mb-3">
            <label for="valor" class="form-label">Valor (R$)</label>
            <input type="number" step="0.01" class="form-control" id="valor" name="valor"
                   value="{{ locacao.valor }}">
        </div>

        <div class="mb-3">
            <label for="frequencia_pagamento" class="form-label">Frequ√™ncia de Pagamento</label>
            <select id="frequencia_pagamento" name="frequencia_pagamento" class="form-select">
                <option value="WEEKLY" {% if locacao.frequencia_pagamento=="WEEKLY" %}selected{% endif %}>Semanal</option>
                <option value="BIWEEKLY" {% if locacao.frequencia_pagamento=="BIWEEKLY" %}selected{% endif %}>Quinzenal</option>
                <option value="MONTHLY" {% if locacao.frequencia_pagamento=="MONTHLY" %}selected{% endif %}>Mensal</option>
                <option value="QUARTERLY" {% if locacao.frequencia_pagamento=="QUARTERLY" %}selected{% endif %}>Trimestral</option>
                <option value="YEARLY" {% if locacao.frequencia_pagamento=="YEARLY" %}selected{% endif %}>Anual</option>
                <option value="CUSTOM" {% if locacao.frequencia_pagamento=="CUSTOM" %}selected{% endif %}>Personalizado</option>
            </select>
        </div>

        <div class="mb-3">
            <label for="observacoes" class="form-label">Observa√ß√µes</label>
            <textarea class="form-control" id="observacoes" name="observacoes">{{ locacao.observacoes }}</textarea>
        </div>

        <button type="submit" class="btn btn-success">Salvar Altera√ß√µes</button>
        <a href="{{ url_for('locacoes') }}" class="btn btn-secondary">Cancelar</a>
    </form>

    <hr>

    <!-- Listagem dos boletos vinculados -->
    <h4>Boletos desta Loca√ß√£o</h4>
    <table class="table table-striped mt-3">
        <thead>
            <tr>
                <th>Vencimento</th>
                <th>Valor</th>
                <th>Status</th>
                <th>Pago em</th>
                <th>A√ß√£o</th>
            </tr>
        </thead>
        <tbody>
            {% for boleto in boletos %}
            <tr>
                <td>{{ boleto.data_vencimento }}</td>
                <td>R$ {{ boleto.valor }}</td>
                <td>
                  {% if boleto.status == 'RECEIVED' %}
                    <span class="badge bg-success">Pago</span>
                  {% elif boleto.status == 'PENDING' %}
                    <span class="badge bg-warning text-dark">Pendente</span>
                  {% elif boleto.status == 'OVERDUE' %}
                    <span class="badge bg-danger">Vencido</span>
                  {% else %}
                    <span class="badge bg-secondary">{{ boleto.status }}</span>
                  {% endif %}
                </td>
                <td>{{ boleto.data_pagamento if boleto.data_pagamento else "-" }}</td>
                <td>
                    {% if boleto.boleto_url %}
                    <a href="{{ boleto.boleto_url }}" target="_blank" class="btn btn-sm btn-primary">Ver Boleto</a>
                    {% endif %}
                </td>
            </tr>
            {% else %}
            <tr>
                <td colspan="5" class="text-center">Nenhum boleto gerado ainda</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% endblock %}