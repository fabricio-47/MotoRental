{% extends "base.html" %}
{% block title %}Locações Canceladas{% endblock %}
{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
  <h2>Locações Canceladas</h2>
  <a class="btn btn-outline-secondary" href="{{ url_for('locacoes') }}">
    <i class="fa-solid fa-arrow-left me-1"></i> Voltar para Ativas
  </a>
</div>

<div class="card">
  <div class="card-header bg-dark text-white">
    <i class="fa-solid fa-ban me-1"></i> Locações Canceladas
  </div>
  <div class="card-body">
    <div class="table-responsive">
      <table class="table table-striped table-hover">
        <thead class="table-dark">
          <tr>
            <th>ID</th>
            <th>Cliente</th>
            <th>Moto</th>
            <th>Placa</th>
            <th>Início</th>
            <th>Fim</th>
            <th>Contrato</th>
            <th>Boleto</th>
            <th>Status</th>
            <th>Valor Pago</th>
            <th>Data Pagamento</th>
            <th>Observações</th>
          </tr>
        </thead>
        <tbody>
          {% for locacao in canceladas %}
          <tr>
            <td>{{ locacao.id }}</td>
            <td>{{ locacao.cliente_nome }}</td>
            <td>{{ locacao.moto_modelo }}</td>
            <td>{{ locacao.moto_placa }}</td>
            <td>{{ locacao.data_inicio }}</td>
            <td>{{ locacao.data_fim or '-' }}</td>
            <td>
              {% if locacao.contrato_pdf %}
                <a class="btn btn-sm btn-outline-dark"
                   href="{{ url_for('uploaded_contract', filename=locacao.contrato_pdf) }}"
                   target="_blank" title="Ver Contrato">
                  <i class="fa-solid fa-file-pdf"></i>
                </a>
              {% else %}
                <span class="text-muted">—</span>
              {% endif %}
            </td>
            <td>
              {% if locacao.boleto_url %}
                <a class="btn btn-sm btn-success"
                  href="{{ locacao.boleto_url }}"
                  target="_blank" title="Ver Boleto">
                  <i class="fa-solid fa-barcode"></i>
                </a>
              {% else %}
                <span class="text-muted">—</span>
              {% endif %}
            </td>
            <td>
              {% if locacao.pagamento_status %}
                <span class="badge bg-{% if locacao.pagamento_status == 'RECEIVED' %}success{% elif locacao.pagamento_status == 'PENDING' %}warning{% elif locacao.pagamento_status == 'OVERDUE' %}danger{% else %}secondary{% endif %}">
                  {{ locacao.pagamento_status }}
                </span>
              {% else %}
                <span class="text-muted">—</span>
              {% endif %}
            </td>
            <td>
              {% if locacao.valor_pago %}
                R$ {{ "%.2f"|format(locacao.valor_pago) }}
              {% else %}
                <span class="text-muted">—</span>
              {% endif %}
            </td>
            <td>{{ locacao.data_pagamento or '—' }}</td>
            <td>{{ locacao.observacoes or '—' }}</td>
          </tr>
          {% else %}
          <tr>
            <td colspan="12" class="text-center text-muted">Nenhuma locação cancelada encontrada.</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
</div>
{% endblock %}